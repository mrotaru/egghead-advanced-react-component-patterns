<html>
  <style>
  .switch { width: 100px; height: 100px; }
  .on { background-color: green; }
  .off { background-color: red; }
  </style>
  <head>
    <script src="https://unpkg.com/react@16.0.0/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.0.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
    <script src="https://unpkg.com/prop-types@15.6.0/prop-types.js"></script>
    <script src="https://unpkg.com/prop-types@15.6.0/prop-types.js"></script>
    <script src="https://cdn.rawgit.com/kentcdodds/ea2fdfc82f79228a6be641c78dc0e1b9/raw/0f792eb8dfb3bf993bdf50c9656f12090ed344e6/hoist-non-react-statics.umd.js"></script>
  </head>
  <body>
    <div id='root'>
    </div>
    <script type="text/babel">

      const TOGGLE_CONTEXT = '__toggle__'

      const withToggle = (Component) => {
        const Wrapper = ({ innerRef, ...props }, context) => {
          const toggleContext = context[TOGGLE_CONTEXT]
          return <Component
            {...props}
            ref={innerRef}
            toggle={toggleContext}
          />
        }
        Wrapper.contextTypes = {
          [TOGGLE_CONTEXT]: PropTypes.object.isRequired,
        }
        Wrapper.displayName = `withToggle(${Component.displayName || Component.name})`
        Wrapper.wrappedComponent = Component
        return hoistNonReactStatics(Wrapper, Component)
      }

      const ToggleButton = ({ toggle: {on, toggle }}) => <Switch {...{on, onClick: toggle}} />
      const ToggleOn = ({ toggle: {on}, children }) => on ? <p className='on'>{children}</p> : null
      const ToggleOff = ({ toggle: {on}, children }) => !on ? <p className='off'>{children}</p> : null
      const ToggleButton2 = withToggle(({ toggle: {on, toggle }}) => <button onClick={toggle}>{on ? 'on' : 'off'}</button>)

      class EventComponent extends React.Component {
        focus = () => this.button.focus()
        render () {
          let { event, on, toggle } = this.props
          const props = { [event]: on }
          return toggle.on
            ? (<button {...props} ref={btn => (this.button = btn)}>The {event} event</button>)
            : null
        }
      }

      class Toggle extends React.Component {
        static defaultProps = { onToggle: () => {} }
        static On = withToggle(ToggleOn)
        static Off = withToggle(ToggleOff)
        static Button = withToggle(ToggleButton)
        static MyEventComponent = withToggle(EventComponent)
        static childContextTypes = {
          [TOGGLE_CONTEXT]: PropTypes.object.isRequired,
        }
        getChildContext = () => ({
          [TOGGLE_CONTEXT]: {
            on: this.state.on,
            toggle: this.toggle,
          }
        })
        state = { on: false }
        toggle = () => this.setState(
          ({on}) => ({on: !on}),
          () => {
            this.props.onToggle(this.state.on)
          }
        )
        render = () => {
          return <div>{this.props.children}</div>
        }
      }

      class App extends React.Component {
        render () {
          return (
            <Toggle onToggle={(on) => { on && this.comp.focus()}} >
              <Toggle.Button />
              <div style={{padding: '20px', backgroundColor: 'gray'}}>
                <Toggle.Off>OFF</Toggle.Off>
                <Toggle.On>ON</Toggle.On>
              </div>
              <ToggleButton2 on='click'/>
              <Toggle.MyEventComponent innerRef={comp => (this.comp = comp)} event='onClick' on={(e) => alert('event!')} />
            </Toggle>
          )
        }
      }

      const Switch = ({on, ...props}) =>
        <div className={`switch ${on ? 'on' : 'off'}`} {...props} />

      ReactDOM.render(<App />, document.getElementById('root'))
    </script>
  </body>
</html>
